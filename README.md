# Парсер цен (Мегамаркет, Ozon)
### Назначение

Ежедневно (раз в сутки при запуске сервера) парсит все товары, которые были добавлены в список. Есть возможность отключать из парсинга товары по выбору с сохранением истории цен у них. Вся история цен записывается в БД.
### Функции
✔️ Парсинг цен на товары из списка  
✔️ Сохранение истории цен  
✔️ Возможность выбрать диапазон дат для просмотра истории цен  
✔️ Отображении на графике истории цены  
✔️ Отображение отклоенения последней цены от минимальной за выбранный период   

### Установка
Введите в терминале следующие команды:  
• для клонирования  репозитория
```sh
git clone https://github.com/FiloniJ/parser.git
```
• для установки необходимых пакетов
```sh
cd parser
npm install --force
```
• для серверной части можно использовать Open Server 5.2.2
Для этого необходимо скачать и установить этот сервер, запустить и в браузере зайти по следующей ссылке
```sh
http://127.0.0.1/openserver/phpmyadmin/index.php
```
Авторизоваться - по умолчанию логин root, пароль пустой.
Далее «Создать БД», вводите имя базы данных **prices** и «Создать».
Далее вкладка «Импорт» и выбираете файл из корневой папки проекта «prices.sql», нажимаете «вперёд». В итоге база данных создана и тестовые данные загружены.

### Использование
• для запуска сервера в первом терминале (запустится автоматический парсинг товаров 1 раз если сегодня не было парсинга)
```sh
npm run server
```
• для запуска клиента во втором терминале
```sh
npm start
```
Если по последней команде выдаёт ошибку, то сперва используйте
```sh
cd parser
```
После запуска откроется новое окно в браузере (обычно по адресу http://localhost:3000/)
1. Если нет ни одного товара. Нажмите на иконку «Добавить новый товар», ввидте URL адрес товара (только озон или мегамаркет), введите название товара и нажмите «Добавить».
2. При первом запуске сервера в новые сутки автоматические запускается парсинг всех активных (не отключеныp из парсинга) товаров. Далее при добавлении нового товара парсинг надо запускать вручную (если сегодня уже был автоматический парсинг товаров) нажав на иконку «Спарсить данный товар» (белый прямоугольник с красной обводкой).
3. График цены можно посмотреть когда в истории будет 2 или больше цен. Описание иконок можно узнать наведя на них курсор.
4. Товар из паринга отключается нажатием на иконку крестика. Вернуть товар в парсинг можно переключившись в меню отключённых из парсинга товаров (икона ON в верхнем меню).



### Особенности проекта
| Функция| Описание| 
|-----------------------|--|
|**Обход антибота**|Крупные площадки ставят защиту от программ ботов. Антибот умеет обходить эту защиту.|
|**Обновление данных из БД**|При измении диапазона дат или количества товара на одном листе кастомные хуки автоматически запрашивают новые данные с сервера.|
|**График цен**|Отображается с помощью D3.js. Если в истории слишком много цен, то цена цифрами на графике отображаются только пра наведении курсора на круг с ценой.|
|**Иконки управлния**|Описание иконок всегда появляется при наведении курсора на них.|


### Возможные ошибки парсинга
• если товара нет в наличии, то площадка не показывает цену и в историю цен запись не вносится. После завершения парсинга в консоли пишет сколько успешных парсингов и какие товары не удалось спарсить.  
• иногда страница сайта очень долго грузится и срабатывает timeout ожидания - помогает запуск одиночного парсинга товара после автопарсинга всех товаров  
• со временем названия классов DOM элементов могут поменяться что потребует поправок в коде чтобы парсер снова начал корректно работать